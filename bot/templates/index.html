<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app.title">Система публикации постов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark">
        <div class="container">
            <span class="navbar-brand mb-0">
                <i class="fas fa-rocket me-2"></i>
                <span data-i18n="app.title">Система публикации постов</span>
            </span>
            <div class="navbar-nav d-flex flex-row align-items-center">
                <div class="language-switcher">
                    <button onclick="setLanguage('ru')" id="lang-ru" class="active">RU</button>
                    <button onclick="setLanguage('en')" id="lang-en">EN</button>
                </div>
                <div class="theme-switcher">
                    <i class="fas fa-sun theme-icon" id="themeIcon"></i>
                    <label class="theme-switcher-toggle">
                        <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                        <span class="theme-switcher-slider"></span>
                    </label>
                </div>
                <button class="btn btn-sm btn-outline-light ms-3" onclick="logout()" title="Выйти">
                    <i class="fas fa-sign-out-alt me-1"></i> Выход
                </button>
                <span class="navbar-text ms-3">
                    <span class="telegram-status" id="telegramStatus"></span>
                    <span id="telegramStatusText" data-i18n="connection.checking">Проверка подключения...</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Навигация по меню -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-home me-2"></i><span data-i18n="nav.dashboard">Главная</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="groups-tab" data-bs-toggle="tab" data-bs-target="#groups" type="button" role="tab">
                    <i class="fas fa-users me-2"></i><span data-i18n="nav.groups">Группы</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button" role="tab">
                    <i class="fas fa-calendar-alt me-2"></i><span data-i18n="nav.schedule">Расписание</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                    <i class="fas fa-history me-2"></i><span data-i18n="nav.history">История</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="statistics-tab" data-bs-toggle="tab" data-bs-target="#statistics" type="button" role="tab">
                    <i class="fas fa-chart-bar me-2"></i><span data-i18n="nav.statistics">Статистика</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templates" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i><span data-i18n="nav.templates">Шаблоны</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview" type="button" role="tab">
                    <i class="fas fa-eye me-2"></i><span data-i18n="nav.preview">Предпросмотр</span>
                </button>
            </li>
        </ul>

        <!-- Содержимое табов -->
        <div class="tab-content" id="mainTabsContent">
            <!-- Главная -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <!-- Статус системы -->
        <div class="row mb-4">
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card status-card fade-in">
                    <div class="card-body text-center">
                        <i class="fas fa-users"></i>
                        <h5 data-i18n="status.groups">Группы</h5>
                        <h3 class="text-primary" id="groupsCount">-</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card status-card fade-in">
                    <div class="card-body text-center">
                        <i class="fas fa-clock"></i>
                        <h5 data-i18n="status.interval">Интервал</h5>
                        <h3 class="text-success" id="interval">-</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card status-card fade-in">
                    <div class="card-body text-center">
                        <i class="fas fa-cogs"></i>
                        <h5 data-i18n="status.scheduler">Планировщик</h5>
                        <span class="badge" id="schedulerStatus">-</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card status-card fade-in">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-alt"></i>
                        <h5 data-i18n="status.nextPublication">Следующая публикация</h5>
                        <small id="nextRun" class="text-muted fw-semibold">-</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card status-card fade-in">
                    <div class="card-body text-center">
                        <i class="fas fa-paper-plane"></i>
                        <h5 data-i18n="status.publication">Статус публикации</h5>
                        <span class="badge bg-secondary" id="publicationStatus">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Статус публикации -->
        <div class="row mb-4" id="publicationStatusPanel" style="display: none;">
            <div class="col-12">
                <div class="card fade-in">
                    <div class="card-header">
                        <h5><i class="fas fa-tasks me-2"></i><span data-i18n="publication.details">Детальный статус публикации</span></h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-list-ul me-2"></i><span data-i18n="publication.currentStep">Текущий этап:</span></h6>
                                <p id="currentStep" class="fw-semibold">-</p>
                                
                                <h6 class="fw-bold text-muted mb-2 mt-3"><i class="fas fa-chart-line me-2"></i><span data-i18n="publication.progress">Прогресс:</span></h6>
                                <div class="progress mb-2">
                                    <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="progressText" class="text-muted fw-semibold">0% (0/0)</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6 class="fw-bold text-muted mb-2"><i class="fas fa-play-circle me-2"></i><span data-i18n="publication.startTime">Время начала:</span></h6>
                                <p id="startTime" class="fw-semibold">-</p>
                                
                                <h6 class="fw-bold text-muted mb-2 mt-3"><i class="fas fa-clock me-2"></i><span data-i18n="publication.lastUpdate">Последнее обновление:</span></h6>
                                <p id="lastUpdate" class="fw-semibold">-</p>
                            </div>
                        </div>
                        
                        <div id="errorsSection" style="display: none;">
                            <hr>
                            <h6 class="fw-bold text-danger mb-3"><i class="fas fa-exclamation-triangle me-2"></i><span data-i18n="publication.errors">Ошибки:</span></h6>
                            <div id="errorsList" class="list-group"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Управление -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card fade-in">
                    <div class="card-header">
                        <h5><i class="fas fa-bolt me-2"></i><span data-i18n="actions.quick">Быстрые действия</span></h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-success btn-loading" id="postNowBtn">
                                <i class="fas fa-paper-plane me-2"></i><span data-i18n="actions.publishNow">Опубликовать сейчас</span>
                            </button>
                            <div class="btn-group" role="group">
                                <button class="btn btn-primary btn-loading" id="startSchedulerBtn">
                                    <i class="fas fa-play me-2"></i><span data-i18n="actions.startScheduler">Запустить планировщик</span>
                                </button>
                                <button class="btn btn-warning btn-loading" id="stopSchedulerBtn">
                                    <i class="fas fa-stop me-2"></i><span data-i18n="actions.stop">Остановить</span>
                                </button>
                            </div>
                            <button class="btn btn-info btn-loading" id="reloadPostBtn">
                                <i class="fas fa-sync me-2"></i><span data-i18n="actions.reloadPost">Перезагрузить пост</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card fade-in">
                    <div class="card-header">
                        <h5><i class="fas fa-sliders-h me-2"></i><span data-i18n="settings.title">Настройки</span></h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="intervalInput" class="form-label fw-semibold">
                                <i class="fas fa-clock me-2"></i><span data-i18n="settings.interval">Интервал публикации</span>
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="intervalInput" min="1" max="10080" value="24" placeholder="Введите число">
                                <select class="form-select" id="intervalUnit" style="max-width: 120px;">
                                    <option value="minutes">мин</option>
                                    <option value="hours" selected>часов</option>
                                </select>
                                <button class="btn btn-primary" id="setIntervalBtn">
                                    <i class="fas fa-check me-2"></i><span data-i18n="settings.set">Установить</span>
                                </button>
                            </div>
                            <small class="form-text text-muted d-block mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                <span data-i18n="settings.maxMinutes">Максимум: 10080 минут (7 дней). Минимум: 1 минута.</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>
            <!-- Расписание -->
            <div class="tab-pane fade" id="schedule" role="tabpanel">
                <!-- Расписание публикаций -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-calendar-alt me-2"></i><span data-i18n="schedule.title">Расписание публикаций</span></h5>
                            </div>
                            <div class="card-body">
                                <!-- Кнопка создания расписания -->
                                <div class="mb-3">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#scheduleModal">
                                        <i class="fas fa-plus me-2"></i><span data-i18n="schedule.create">Создать расписание</span>
                                    </button>
                                </div>
                                
                                <!-- Таблица расписаний -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th data-i18n="schedule.table.type">Тип</th>
                                                <th data-i18n="schedule.table.details">Детали</th>
                                                <th data-i18n="schedule.table.status">Статус</th>
                                                <th data-i18n="schedule.table.created">Создано</th>
                                                <th data-i18n="schedule.table.actions">Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody id="schedulesList">
                                            <tr>
                                                <td colspan="5" class="text-center">
                                                    <i class="fas fa-spinner fa-spin"></i> <span data-i18n="schedule.loading">Загрузка...</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Группы -->
            <div class="tab-pane fade" id="groups" role="tabpanel">
                <!-- Управление группами -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-plus-circle me-2"></i><span data-i18n="groups.add">Добавить группу/канал</span></h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="groupInput" class="form-label fw-semibold">
                                        <i class="fas fa-link me-2"></i><span data-i18n="groups.input">Ссылка, @username или ID</span>
                                    </label>
                                    <input type="text" class="form-control" id="groupInput" 
                                           placeholder="@group_name, -1001234567890, https://t.me/group_name">
                                </div>
                                <button class="btn btn-primary btn-loading w-100" id="addGroupBtn">
                                    <i class="fas fa-plus me-2"></i><span data-i18n="groups.addButton">Добавить группу</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-list me-2"></i><span data-i18n="groups.list">Список групп/каналов</span></h5>
                            </div>
                            <div class="card-body">
                                <div id="groupsList">
                                    <div class="empty-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p data-i18n="groups.loading">Загрузка групп...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- История -->
            <div class="tab-pane fade" id="history" role="tabpanel">
                <!-- История публикаций -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-history me-2"></i><span data-i18n="history.title">История публикаций</span></h5>
                            </div>
                            <div class="card-body">
                                <!-- Фильтры -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-filter me-1"></i><span data-i18n="history.filters.status">Статус</span></label>
                                        <select class="form-select" id="historyStatusFilter">
                                            <option value="">Все</option>
                                            <option value="success">Успешные</option>
                                            <option value="error">Ошибки</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label"><i class="fas fa-search me-1"></i><span data-i18n="history.filters.search">Поиск</span></label>
                                        <input type="text" class="form-control" id="historySearchFilter" placeholder="Название группы...">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label"><i class="fas fa-calendar me-1"></i><span data-i18n="history.filters.dateFrom">С даты</span></label>
                                        <input type="date" class="form-control" id="historyDateFromFilter">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label"><i class="fas fa-calendar me-1"></i><span data-i18n="history.filters.dateTo">По дату</span></label>
                                        <input type="date" class="form-control" id="historyDateToFilter">
                                    </div>
                                    <div class="col-md-2 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="historyFilterBtn">
                                            <i class="fas fa-filter me-1"></i><span data-i18n="history.filters.apply">Применить</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Таблица истории -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th data-i18n="history.table.time">Время</th>
                                                <th data-i18n="history.table.group">Группа</th>
                                                <th data-i18n="history.table.status">Статус</th>
                                                <th data-i18n="history.table.retries">Попытки</th>
                                                <th data-i18n="history.table.error">Ошибка</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyTableBody">
                                            <tr>
                                                <td colspan="5" class="text-center">
                                                    <i class="fas fa-spinner fa-spin"></i> <span data-i18n="history.loading">Загрузка...</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Пагинация -->
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary" id="historyPrevBtn" disabled>
                                            <i class="fas fa-chevron-left"></i> <span data-i18n="history.prev">Назад</span>
                                        </button>
                                        <span class="mx-2" id="historyPageInfo">1 / 1</span>
                                        <button class="btn btn-sm btn-outline-secondary" id="historyNextBtn" disabled>
                                            <span data-i18n="history.next">Вперед</span> <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger" id="historyClearBtn">
                                        <i class="fas fa-trash me-1"></i><span data-i18n="history.clear">Очистить историю</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Статистика -->
            <div class="tab-pane fade" id="statistics" role="tabpanel">
                <!-- Статистика публикаций -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar me-2"></i><span data-i18n="statistics.title">Статистика публикаций</span></h5>
                            </div>
                            <div class="card-body">
                                <!-- Карточки статистики -->
                                <div class="row mb-4">
                                    <div class="col-md-3 mb-3">
                                        <div class="card bg-primary text-white">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="fas fa-file-alt me-2"></i><span data-i18n="statistics.total">Всего публикаций</span></h6>
                                                <h2 id="statTotal">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card bg-success text-white">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="fas fa-check-circle me-2"></i><span data-i18n="statistics.successful">Успешных</span></h6>
                                                <h2 id="statSuccessful">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card bg-danger text-white">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="fas fa-times-circle me-2"></i><span data-i18n="statistics.failed">Неудачных</span></h6>
                                                <h2 id="statFailed">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="card bg-info text-white">
                                            <div class="card-body">
                                                <h6 class="card-title"><i class="fas fa-percentage me-2"></i><span data-i18n="statistics.successRate">Процент успеха</span></h6>
                                                <h2 id="statSuccessRate">0%</h2>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Графики -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-chart-line me-2"></i><span data-i18n="statistics.dailyActivity">Активность по дням</span></h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="dailyChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-chart-pie me-2"></i><span data-i18n="statistics.successRate">Процент успеха</span></h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="successRateChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- График активности по часам и топ групп -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-clock me-2"></i><span data-i18n="statistics.hourlyActivity">Активность по часам</span></h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="hourlyChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6><i class="fas fa-trophy me-2"></i><span data-i18n="statistics.topGroups">Топ групп</span></h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="topGroupsChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Фильтры дат для статистики -->
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label class="form-label"><i class="fas fa-calendar me-1"></i><span data-i18n="statistics.filterFrom">С даты</span></label>
                                        <input type="date" class="form-control" id="statDateFrom">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"><i class="fas fa-calendar me-1"></i><span data-i18n="statistics.filterTo">По дату</span></label>
                                        <input type="date" class="form-control" id="statDateTo">
                                    </div>
                                    <div class="col-md-4 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="statFilterBtn">
                                            <i class="fas fa-filter me-1"></i><span data-i18n="statistics.filterApply">Применить</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Шаблоны -->
            <div class="tab-pane fade" id="templates" role="tabpanel">
                <!-- Шаблоны постов -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-file-alt me-2"></i><span data-i18n="templates.title">Шаблоны постов</span></h5>
                            </div>
                            <div class="card-body">
                                <!-- Кнопка создания шаблона -->
                                <div class="mb-3">
                                    <button class="btn btn-primary" id="createTemplateBtn" data-bs-toggle="modal" data-bs-target="#templateModal">
                                        <i class="fas fa-plus me-2"></i><span data-i18n="templates.create">Создать шаблон</span>
                                    </button>
                                </div>

                                <!-- Список шаблонов -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th data-i18n="templates.table.name">Название</th>
                                                <th data-i18n="templates.table.content">Содержимое</th>
                                                <th data-i18n="templates.table.status">Статус</th>
                                                <th data-i18n="templates.table.actions">Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody id="templatesTableBody">
                                            <tr>
                                                <td colspan="4" class="text-center">
                                                    <i class="fas fa-spinner fa-spin"></i> <span data-i18n="templates.loading">Загрузка...</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Информация о переменных -->
                                <div class="alert alert-info mt-3">
                                    <h6><i class="fas fa-info-circle me-2"></i><span data-i18n="templates.variables.title">Доступные переменные:</span></h6>
                                    <ul class="mb-0">
                                        <li><code>{date}</code> - <span data-i18n="templates.variables.date">текущая дата</span></li>
                                        <li><code>{time}</code> - <span data-i18n="templates.variables.time">текущее время</span></li>
                                        <li><code>{datetime}</code> - <span data-i18n="templates.variables.datetime">дата и время</span></li>
                                        <li><code>{chat_id}</code> - <span data-i18n="templates.variables.chatId">ID чата</span></li>
                                        <li><code>{chat_title}</code> - <span data-i18n="templates.variables.chatTitle">название чата</span></li>
                                        <li><code>{random_number}</code> - <span data-i18n="templates.variables.random">случайное число (1-1000)</span></li>
                                        <li><code>{random_number:min:max}</code> - <span data-i18n="templates.variables.randomRange">случайное число от min до max</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Предпросмотр -->
            <div class="tab-pane fade" id="preview" role="tabpanel">
                <!-- Предпросмотр поста -->
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-eye me-2"></i><span data-i18n="preview.title">Предпросмотр поста</span></h5>
                            </div>
                            <div class="card-body">
                                <!-- Выбор группы для предпросмотра -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="previewChatSelect" class="form-label"><span data-i18n="preview.selectGroup">Выберите группу для предпросмотра:</span></label>
                                        <select class="form-select" id="previewChatSelect">
                                            <option value="" data-i18n="preview.testGroup">Тестовая группа</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 d-flex align-items-end">
                                        <button class="btn btn-primary" id="updatePreviewBtn">
                                            <i class="fas fa-sync me-1"></i><span data-i18n="preview.update">Обновить предпросмотр</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Telegram-подобный предпросмотр -->
                                <div class="telegram-preview-container">
                                    <div class="telegram-message">
                                        <div class="telegram-message-header">
                                            <div class="telegram-avatar">
                                                <i class="fas fa-user-circle"></i>
                                            </div>
                                            <div class="telegram-message-info">
                                                <span class="telegram-author" data-i18n="preview.author">Вы</span>
                                                <span class="telegram-time" id="previewTime"></span>
                                            </div>
                                        </div>
                                        <div class="telegram-message-content">
                                            <div class="telegram-text" id="previewText">
                                                <i class="fas fa-spinner fa-spin"></i> <span data-i18n="preview.loading">Загрузка...</span>
                                            </div>
                                            <div class="telegram-image" id="previewImage" style="display: none;">
                                                <img id="previewImageElement" src="" alt="" style="display: none;" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Информация о посте -->
                                <div class="mt-3">
                                    <small class="text-muted">
                                        <span data-i18n="preview.info">Длина текста:</span> <span id="previewTextLength">0</span> <span data-i18n="preview.chars">символов</span>
                                        <span class="ms-3" id="previewTemplateInfo" style="display: none;">
                                            <i class="fas fa-file-alt me-1"></i><span data-i18n="preview.usingTemplate">Используется шаблон:</span> <span id="previewTemplateName"></span>
                                        </span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для создания/редактирования шаблона -->
    <div class="modal fade" id="templateModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templateModalTitle" data-i18n="templates.create">Создать шаблон</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="templateForm">
                        <input type="hidden" id="templateId" value="">
                        <div class="mb-3">
                            <label for="templateName" class="form-label"><span data-i18n="templates.form.name">Название</span></label>
                            <input type="text" class="form-control" id="templateName" required>
                        </div>
                        <div class="mb-3">
                            <label for="templateContent" class="form-label"><span data-i18n="templates.form.content">Содержимое</span></label>
                            <textarea class="form-control" id="templateContent" rows="10" required></textarea>
                            <small class="form-text text-muted">
                                <span data-i18n="templates.form.variablesHint">Используйте переменные в фигурных скобках, например: {date}, {chat_title}</span>
                            </small>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-secondary" id="previewTemplateBtn">
                                <i class="fas fa-eye me-1"></i><span data-i18n="templates.form.preview">Предпросмотр</span>
                            </button>
                        </div>
                        <div id="templatePreview" class="alert alert-light" style="display: none;">
                            <h6><span data-i18n="templates.form.previewTitle">Предпросмотр:</span></h6>
                            <pre id="templatePreviewContent" class="mb-0"></pre>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><span data-i18n="common.cancel">Отмена</span></button>
                    <button type="button" class="btn btn-primary" id="saveTemplateBtn"><span data-i18n="common.save">Сохранить</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для создания/редактирования расписания -->
    <div class="modal fade" id="scheduleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalTitle" data-i18n="schedule.create">Создать расписание</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="scheduleForm">
                        <input type="hidden" id="scheduleId" value="">
                        
                        <!-- Тип расписания -->
                        <div class="mb-3">
                            <label for="scheduleType" class="form-label"><span data-i18n="schedule.form.type">Тип расписания</span></label>
                            <select class="form-select" id="scheduleType" required>
                                <option value="interval" data-i18n="schedule.types.interval">Интервал</option>
                                <option value="time" data-i18n="schedule.types.time">Конкретное время</option>
                                <option value="days" data-i18n="schedule.types.days">Дни недели</option>
                                <option value="hours" data-i18n="schedule.types.hours">Часовое окно</option>
                            </select>
                        </div>
                        
                        <!-- Поля для интервала -->
                        <div id="scheduleIntervalFields" class="schedule-type-fields">
                            <div class="mb-3">
                                <label for="intervalMinutes" class="form-label"><span data-i18n="schedule.form.intervalMinutes">Интервал (минуты)</span></label>
                                <input type="number" class="form-control" id="intervalMinutes" min="1" max="10080" value="1440">
                            </div>
                        </div>
                        
                        <!-- Поля для конкретного времени -->
                        <div id="scheduleTimeFields" class="schedule-type-fields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="timeHour" class="form-label"><span data-i18n="schedule.form.hour">Час</span></label>
                                    <input type="number" class="form-control" id="timeHour" min="0" max="23" value="12">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="timeMinute" class="form-label"><span data-i18n="schedule.form.minute">Минута</span></label>
                                    <input type="number" class="form-control" id="timeMinute" min="0" max="59" value="0">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Поля для дней недели -->
                        <div id="scheduleDaysFields" class="schedule-type-fields" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label"><span data-i18n="schedule.form.days">Дни недели</span></label>
                                <div class="d-flex flex-wrap gap-2">
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="0"> <span data-i18n="schedule.days.mon">Пн</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="1"> <span data-i18n="schedule.days.tue">Вт</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="2"> <span data-i18n="schedule.days.wed">Ср</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="3"> <span data-i18n="schedule.days.thu">Чт</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="4"> <span data-i18n="schedule.days.fri">Пт</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="5"> <span data-i18n="schedule.days.sat">Сб</span>
                                    </label>
                                    <label class="btn btn-outline-primary">
                                        <input type="checkbox" class="schedule-day-checkbox" value="6"> <span data-i18n="schedule.days.sun">Вс</span>
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="daysHour" class="form-label"><span data-i18n="schedule.form.hour">Час</span></label>
                                    <input type="number" class="form-control" id="daysHour" min="0" max="23" value="12">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="daysMinute" class="form-label"><span data-i18n="schedule.form.minute">Минута</span></label>
                                    <input type="number" class="form-control" id="daysMinute" min="0" max="59" value="0">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Поля для часового окна -->
                        <div id="scheduleHoursFields" class="schedule-type-fields" style="display: none;">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="hoursStart" class="form-label"><span data-i18n="schedule.form.startHour">Начальный час</span></label>
                                    <input type="number" class="form-control" id="hoursStart" min="0" max="23" value="9">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="hoursEnd" class="form-label"><span data-i18n="schedule.form.endHour">Конечный час</span></label>
                                    <input type="number" class="form-control" id="hoursEnd" min="0" max="23" value="18">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="hoursInterval" class="form-label"><span data-i18n="schedule.form.intervalMinutes">Интервал (минуты)</span></label>
                                    <input type="number" class="form-control" id="hoursInterval" min="1" max="1440" value="60">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Активировать сразу -->
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="scheduleActive">
                                <label class="form-check-label" for="scheduleActive">
                                    <span data-i18n="schedule.form.activate">Активировать сразу</span>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><span data-i18n="common.cancel">Отмена</span></button>
                    <button type="button" class="btn btn-primary" id="saveScheduleBtn"><span data-i18n="common.save">Сохранить</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast для уведомлений -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto" data-i18n="toast.notification">Уведомление</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastBody">
                <!-- Сообщение будет вставлено сюда -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/groups.js"></script>
    <script src="/static/js/scheduler.js"></script>
    <script src="/static/js/history.js"></script>
    <script src="/static/js/statistics.js"></script>
    <script src="/static/js/templates.js"></script>
    <script src="/static/js/preview.js"></script>
    <script>
        // Глобальные переменные
        let statusInterval;
        let groupsInterval;
        window.lastGroupsData = null; // Кэш последних данных групп
        let currentLanguage = localStorage.getItem('language') || 'ru';
        let currentTheme = localStorage.getItem('theme') || 'light';
        
        // История публикаций
        window.historyPage = 1;
        window.historyPageSize = 20;
        window.historyFilters = {
            status: '',
            search: '',
            start_date: '',
            end_date: ''
        };

        // Функции для работы с темой и языком
        function toggleTheme() {
            const checkbox = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            if (checkbox.checked) {
                currentTheme = 'dark';
                document.documentElement.setAttribute('data-theme', 'dark');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-moon theme-icon';
                }
            } else {
                currentTheme = 'light';
                document.documentElement.setAttribute('data-theme', 'light');
                if (themeIcon) {
                    themeIcon.className = 'fas fa-sun theme-icon';
                }
            }
            localStorage.setItem('theme', currentTheme);
        }

        function setTheme(theme) {
            currentTheme = theme;
            const checkbox = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            if (checkbox) {
                checkbox.checked = theme === 'dark';
            }
            if (themeIcon) {
                themeIcon.className = theme === 'dark' ? 'fas fa-moon theme-icon' : 'fas fa-sun theme-icon';
            }
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        function setLanguage(lang) {
            window.currentLanguage = lang;
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            // Обновляем активную кнопку
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Обновляем тексты
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (window.translations[lang] && window.translations[lang][key]) {
                    element.textContent = window.translations[lang][key];
                }
            });
            
            // Обновляем тексты в динамически созданных элементах (например, в списке групп)
            document.querySelectorAll('[data-i18n-key]').forEach(element => {
                const key = element.getAttribute('data-i18n-key');
                if (window.translations[lang] && window.translations[lang][key]) {
                    element.textContent = window.translations[lang][key];
                }
            });
            
            // Обновляем опции select
            const intervalUnit = document.getElementById('intervalUnit');
            if (intervalUnit) {
                intervalUnit.querySelector('option[value="minutes"]').textContent = window.t('unit.minutes');
                intervalUnit.querySelector('option[value="hours"]').textContent = window.t('unit.hours');
            }
            
            // Обновляем динамические тексты
            updateDynamicTexts();
            
            // Немедленно обновляем статусы, которые могут изменяться
            const schedulerStatus = document.getElementById('schedulerStatus');
            if (schedulerStatus && schedulerStatus.textContent) {
                const currentStatus = schedulerStatus.textContent.trim();
                // Определяем текущий статус на основе класса или текста
                const isRunning = schedulerStatus.classList.contains('bg-success') || 
                                 currentStatus === 'Запущен' || 
                                 currentStatus === 'Running';
                schedulerStatus.textContent = isRunning ? window.t('status.running') : window.t('status.stopped');
            }
            
            // Обновляем статус публикации, если он есть
            const publicationStatus = document.getElementById('publicationStatus');
            if (publicationStatus && publicationStatus.textContent) {
                const currentPubStatus = publicationStatus.textContent.trim();
                if (currentPubStatus === 'Публикация' || currentPubStatus === 'Publishing') {
                    publicationStatus.textContent = window.t('status.publishing');
                } else if (currentPubStatus === 'Ожидание' || currentPubStatus === 'Waiting') {
                    publicationStatus.textContent = window.t('status.waiting');
                } else if (currentPubStatus === 'Неактивно' || currentPubStatus === 'Not Active') {
                    publicationStatus.textContent = window.t('status.notActive');
                }
            }
            
            // Обновляем динамические тексты
            updateDynamicTexts();
            
            // Принудительно обновляем статус для получения актуальных данных
            loadStatus();
        }

        function updateDynamicTexts() {
            // Обновляем заголовок страницы
            const titleElement = document.querySelector('title[data-i18n]');
            if (titleElement) {
                const key = titleElement.getAttribute('data-i18n');
                if (window.translations[window.currentLanguage] && window.translations[window.currentLanguage][key]) {
                    titleElement.textContent = window.translations[window.currentLanguage][key];
                }
            }
            // Обновляем статусы, которые могут изменяться
            const telegramStatusText = document.getElementById('telegramStatusText');
            if (telegramStatusText) {
                // Это будет обновлено в updateStatus
            }
        }

        // Экспортируем функцию в глобальную область видимости для использования в модулях
        window.updateDynamicTexts = updateDynamicTexts;

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Применяем сохраненную тему
            setTheme(currentTheme);
            
            // Применяем сохраненный язык
            setLanguage(currentLanguage);
            
            // Проверяем доступность функций из модулей
            console.log('Checking module functions availability:');
            console.log('loadStatus:', typeof window.loadStatus);
            console.log('loadGroups:', typeof window.loadGroups);
            console.log('loadSchedules:', typeof window.loadSchedules);
            console.log('loadHistory:', typeof window.loadHistory);
            console.log('loadStatistics:', typeof window.loadStatistics);
            console.log('loadTemplates:', typeof window.loadTemplates);
            console.log('loadPostPreview:', typeof window.loadPostPreview);
            
            if (typeof window.loadStatus === 'function') {
                window.loadStatus();
            } else {
                console.error('loadStatus is not available');
            }
            if (typeof window.loadGroups === 'function') {
                window.loadGroups();
            } else {
                console.error('loadGroups is not available');
            }
            
            // Автообновление статуса каждые 2 секунды
            setInterval(() => {
                window.loadStatus();
            }, 2000);
            
            // Обновляем статус каждые 5 секунд
            statusInterval = setInterval(() => window.loadStatus(), 5000);
            // Обновляем группы реже - каждые 30 секунд (моргание исправлено через кэширование)
            groupsInterval = setInterval(() => window.loadGroups(), 30000);
            
            // Обработчики событий
            setupEventListeners();
            
            // Обработчики переключения табов
            const tabButtons = document.querySelectorAll('#mainTabs button[data-bs-toggle="tab"]');
            console.log('Found tab buttons:', tabButtons.length);
            
            tabButtons.forEach(button => {
                // Используем событие 'shown.bs.tab', которое срабатывает ПОСЛЕ полного показа таба
                button.addEventListener('shown.bs.tab', function (e) {
                    const targetId = e.target.getAttribute('data-bs-target');
                    console.log('Tab switched to:', targetId);
                    
                    // Небольшая задержка для гарантии, что Bootstrap полностью показал вкладку
                    setTimeout(() => {
                        console.log('Loading data for tab:', targetId);
                        console.log('targetId type:', typeof targetId, 'value:', targetId);
                        
                        // Загружаем данные для соответствующего таба
                        if (targetId === '#groups') {
                            console.log('Calling loadGroups()');
                            if (typeof window.loadGroups === 'function') {
                                window.loadGroups();
                            } else {
                                console.error('loadGroups is not available');
                            }
                        } else if (targetId === '#schedule') {
                            console.log('Calling loadSchedules() - targetId matches #schedule');
                            console.log('loadSchedules type:', typeof window.loadSchedules);
                            console.log('loadSchedules function:', window.loadSchedules);
                            if (typeof window.loadSchedules === 'function') {
                                try {
                                    console.log('About to call loadSchedules...');
                                    const result = window.loadSchedules();
                                    console.log('loadSchedules call result:', result);
                                    if (result && result.catch) {
                                        result.catch(err => {
                                            console.error('loadSchedules promise rejected:', err);
                                        });
                                    }
                                } catch (e) {
                                    console.error('Error calling loadSchedules:', e);
                                    console.error('Error stack:', e.stack);
                                }
                            } else {
                                console.error('loadSchedules is not available');
                            }
                        } else if (targetId === '#history') {
                            console.log('Calling loadHistory()');
                            if (typeof window.loadHistory === 'function') {
                                window.loadHistory();
                            } else {
                                console.error('loadHistory is not available');
                            }
                        } else if (targetId === '#statistics') {
                            console.log('Calling loadStatistics()');
                            if (typeof window.loadStatistics === 'function') {
                                window.loadStatistics();
                            } else {
                                console.error('loadStatistics is not available');
                            }
                        } else if (targetId === '#templates') {
                            console.log('Calling loadTemplates()');
                            if (typeof window.loadTemplates === 'function') {
                                window.loadTemplates();
                            } else {
                                console.error('loadTemplates is not available');
                            }
                        } else if (targetId === '#preview') {
                            console.log('Calling loadPostPreview()');
                            if (typeof window.loadPostPreview === 'function') {
                                window.loadPostPreview();
                            } else {
                                console.error('loadPostPreview is not available');
                            }
                            if (typeof window.loadGroupsForPreview === 'function') {
                                window.loadGroupsForPreview();
                            } else {
                                console.error('loadGroupsForPreview is not available');
                            }
                        }
                    }, 100); // Небольшая задержка для гарантии видимости вкладки
                });
                
                // Также слушаем событие 'show.bs.tab' для принудительного добавления класса show
                button.addEventListener('show.bs.tab', function (e) {
                    const targetId = e.target.getAttribute('data-bs-target');
                    const targetTab = document.querySelector(targetId);
                    if (targetTab) {
                        // Принудительно добавляем класс show и убираем fade для немедленного отображения
                        targetTab.classList.remove('fade');
                        targetTab.classList.add('show', 'active');
                        targetTab.style.display = 'block';
                        targetTab.style.opacity = '1';
                        targetTab.style.visibility = 'visible';
                        
                        console.log('Tab activated:', targetId, 'Classes:', targetTab.className);
                    }
                });
            });
            
            // Инициализируем данные только для активного таба (dashboard)
            // Остальные табы будут загружать данные при активации через обработчик shown.bs.tab
            // Это предотвращает загрузку данных в невидимые вкладки
            console.log('Initial data load: Dashboard is already active, data loaded via loadStatus() and loadGroups()');
        });

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Добавление группы
            document.getElementById('addGroupBtn').addEventListener('click', window.addGroup);
            
            // Установка интервала
            const setIntervalBtn = document.getElementById('setIntervalBtn');
            if (setIntervalBtn) {
                setIntervalBtn.addEventListener('click', window.setIntervalValue);
            }
            
            // Быстрые действия
            document.getElementById('postNowBtn').addEventListener('click', window.postNow);
            document.getElementById('startSchedulerBtn').addEventListener('click', window.startScheduler);
            document.getElementById('stopSchedulerBtn').addEventListener('click', window.stopScheduler);
            document.getElementById('reloadPostBtn').addEventListener('click', window.reloadPost);

            // Enter в поле добавления группы
            document.getElementById('groupInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    window.addGroup();
                }
            });
            
            // Шаблоны
            document.getElementById('createTemplateBtn').addEventListener('click', () => {
                window.resetTemplateForm();
            });
            document.getElementById('saveTemplateBtn').addEventListener('click', window.saveTemplate);
            document.getElementById('previewTemplateBtn').addEventListener('click', window.previewTemplate);
            
            // Расписания
            document.getElementById('scheduleType').addEventListener('change', window.updateScheduleTypeFields);
            document.getElementById('saveScheduleBtn').addEventListener('click', window.saveSchedule);
            document.getElementById('scheduleModal').addEventListener('show.bs.modal', window.resetScheduleForm);
            
            // Предпросмотр поста
            document.getElementById('updatePreviewBtn').addEventListener('click', window.updatePostPreview);
            
            // Фильтры истории
            document.getElementById('historyFilterBtn').addEventListener('click', function() {
                window.historyFilters = {
                    status: document.getElementById('historyStatusFilter').value,
                    search: document.getElementById('historySearchFilter').value,
                    start_date: document.getElementById('historyDateFromFilter').value,
                    end_date: document.getElementById('historyDateToFilter').value
                };
                window.historyPage = 1;
                window.loadHistory();
            });

            // Пагинация истории
            document.getElementById('historyPrevBtn').addEventListener('click', function() {
                if (window.historyPage > 1) {
                    window.historyPage--;
                    window.loadHistory();
                }
            });
            document.getElementById('historyNextBtn').addEventListener('click', function() {
                window.historyPage++;
                window.loadHistory();
            });

            // Очистка истории
            document.getElementById('historyClearBtn').addEventListener('click', window.clearHistory);

            // Фильтры статистики
            document.getElementById('statFilterBtn').addEventListener('click', window.loadStatistics);
            
            // НЕ загружаем данные для всех вкладок при инициализации
            // Данные будут загружаться только при переключении на соответствующую вкладку
            // Это предотвращает загрузку данных в невидимые вкладки
        }

        function updateButtonTranslations(button) {
            // Обновляем переводы в кнопке после восстановления
            const i18nElements = button.querySelectorAll('[data-i18n]');
            i18nElements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (window.translations[window.currentLanguage] && window.translations[window.currentLanguage][key]) {
                    element.textContent = window.translations[window.currentLanguage][key];
                }
            });
        }
    </script>
</body>
</html>